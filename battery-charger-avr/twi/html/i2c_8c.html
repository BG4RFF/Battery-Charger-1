<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>AVR I2C Master Library: i2c.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<h1>i2c.c File Reference</h1><code>#include &lt;avr/io.h&gt;</code><br>
<code>#include &lt;avr/interrupt.h&gt;</code><br>
<code>#include &quot;<a class="el" href="i2c_8h-source.html">i2c.h</a>&quot;</code><br>

<p>
Include dependency graph for i2c.c:<p><center><img src="i2c_8c__incl.png" border="0" usemap="#i2c.c_map" alt=""></center>
<map name="i2c.c_map">
<area href="i2c_8h.html" shape="rect" coords="143,107,199,133" alt="">
</map>

<p>
<a href="i2c_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#528a67cfb212764fdec08c7c065a04f8">TRUE</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#b5b5527380b5b259294fa10ae7e3a59b">FALSE</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#fe7c859443efabc1eb3a47bdf8abdf3c">twiInit</a> (uint16_t bitRate)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialise the TWI interface.  <a href="#fe7c859443efabc1eb3a47bdf8abdf3c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#439ac51801d573da902afa09abf871c1">twiErrorStatus</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check the error status of a transaction.  <a href="#439ac51801d573da902afa09abf871c1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#71aad4195d87f8c719f6fef3f1d17e8e">twiCompletionStatus</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check the completion status of a transaction.  <a href="#71aad4195d87f8c719f6fef3f1d17e8e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#f4ded1cc09e6f5b30c44d48a198c08a5">twiSetupTransaction</a> (uint8_t numBytes)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Clear the read and write buffers and set the bytes to be read.  <a href="#f4ded1cc09e6f5b30c44d48a198c08a5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#2cb90fd0e5a775d5be957c0a7617fca2">twiWriteByte</a> (uint8_t dataByte)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write the next transmitted byte to the write buffer.  <a href="#2cb90fd0e5a775d5be957c0a7617fca2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#0e20b6beb36cbeea87e0cad72b90829f">twiReadByte</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read the next received byte from the read buffer.  <a href="#0e20b6beb36cbeea87e0cad72b90829f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#cc2a1b3d7c45f9721291f024262988a4">twiLaunch</a> (uint8_t device)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Launch a master transaction with a slave device.  <a href="#cc2a1b3d7c45f9721291f024262988a4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#516fb048c3c00d1cab7bfdc8f5999955">ISR</a> (SIG_TWI)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">ISR for the TWI transaction.  <a href="#516fb048c3c00d1cab7bfdc8f5999955"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#7fdb3f4462c25ceb53f923c697d904c2">twiWriteBuffer</a> [BUFFER_SIZE]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#8346cb3961702395920073c0fc633cda">twiReadBuffer</a> [BUFFER_SIZE]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#a3999b6dd3f5153e28720c1f7a4a8496">writeInPointer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#7c5aa6646338d4b0375c16a011380f2d">writeOutPointer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#07881f4dd76bb3248bb4a3556aa9ebcd">readInPointer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#6b80d6db55239fc3eaccaa8ced9143d0">readOutPointer</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#76c1e63ec99027b5f7991d5f0ad099da">readCount</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#041be4eeebb2ae2bb8e4a5de96ba208b">twiState</a> = TWI_IDLE</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#ebe86cb4e006a71152269ec077d71559">twiTransactionType</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#9cdbe69356f0acf2eb14f6ae6ec97339">twiLastError</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8c.html#bdb98999790665ec01fb67c8cbcf7542">twiDevice</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="b5b5527380b5b259294fa10ae7e3a59b"></a><!-- doxytag: member="i2c.c::FALSE" ref="b5b5527380b5b259294fa10ae7e3a59b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FALSE&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00056">56</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00220">twiLaunch()</a>, and <a class="el" href="i2c_8c-source.html#l00179">twiWriteByte()</a>.
</div>
</div><p>
<a class="anchor" name="528a67cfb212764fdec08c7c065a04f8"></a><!-- doxytag: member="i2c.c::TRUE" ref="528a67cfb212764fdec08c7c065a04f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TRUE&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00055">55</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00220">twiLaunch()</a>, and <a class="el" href="i2c_8c-source.html#l00179">twiWriteByte()</a>.
</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="516fb048c3c00d1cab7bfdc8f5999955"></a><!-- doxytag: member="i2c.c::ISR" ref="516fb048c3c00d1cab7bfdc8f5999955" args="(SIG_TWI)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR           </td>
          <td>(</td>
          <td class="paramtype">SIG_TWI&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
ISR for the TWI transaction. 
<p>
The main grunt in the code is in the ISR. This works through various states of the TWI transaction. An atomic write/read transaction will convert to a read transaction when the first write part has been completed. A repeated start will be made.<p>
If the device responds with a NAK, the ISR simply terminates the transaction. The program can determine whether the transaction completed fully by examining the states of the pointers.<p>
Take care not to confuse twiState which controls the states of the transaction, and twiStatus which is returned by the hardware after an event occurs. 
<p>
After the START condition has been transmitted and successfully acknowledged, the ADDRESS state is setup for the next interrupt. The device address is sent along with the R/W bit<p>
When the device address is successfully transmitted, prepare for reading the first data byte<p>
During the data read phase, each byte read must be acknowledged explicitely on the previous data read by setting the TWEA bit to 1 for an ACK and 0 for a NACK when sending the last byte. If the slave returns a NACK, then reading must stop as it has no further data to send. The current data item is valid.<p>
During the data transmission phase, stop if all bytes have been sent, otherwise send next byte unless receiver has responded with a NACK to indicate it cannot accept any more data. When finished, the number of bytes remaining to be sent is stored back in the beginning of the buffer. If we have an atomic write/read transaction, send a repeated start when complete, and convert to a read transaction. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00257">257</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
References <a class="el" href="i2c_8h-source.html#l00074">_BV</a>, <a class="el" href="i2c_8h-source.html#l00063">ATOMIC_TRANSACTION</a>, <a class="el" href="i2c_8h-source.html#l00075">inb</a>, <a class="el" href="i2c_8h-source.html#l00057">MR_DATA_ACK</a>, <a class="el" href="i2c_8h-source.html#l00058">MR_DATA_NACK</a>, <a class="el" href="i2c_8h-source.html#l00055">MR_SLA_ACK</a>, <a class="el" href="i2c_8h-source.html#l00056">MR_SLA_NACK</a>, <a class="el" href="i2c_8h-source.html#l00053">MT_DATA_ACK</a>, <a class="el" href="i2c_8h-source.html#l00054">MT_DATA_NACK</a>, <a class="el" href="i2c_8h-source.html#l00051">MT_SLA_ACK</a>, <a class="el" href="i2c_8h-source.html#l00052">MT_SLA_NACK</a>, <a class="el" href="i2c_8h-source.html#l00077">outb</a>, <a class="el" href="i2c_8h-source.html#l00065">READ_TRANSACTION</a>, <a class="el" href="i2c_8c-source.html#l00068">readCount</a>, <a class="el" href="i2c_8c-source.html#l00066">readInPointer</a>, <a class="el" href="i2c_8h-source.html#l00047">TWI_ADDRESS</a>, <a class="el" href="i2c_8h-source.html#l00068">TWI_CONTROL</a>, <a class="el" href="i2c_8h-source.html#l00048">TWI_DATA_PHASE</a>, <a class="el" href="i2c_8h-source.html#l00046">TWI_IDLE</a>, <a class="el" href="i2c_8h-source.html#l00050">TWI_REPEATED_START</a>, <a class="el" href="i2c_8h-source.html#l00049">TWI_START</a>, <a class="el" href="i2c_8h-source.html#l00069">TWI_STOP</a>, <a class="el" href="i2c_8c-source.html#l00072">twiDevice</a>, <a class="el" href="i2c_8c-source.html#l00071">twiLastError</a>, <a class="el" href="i2c_8c-source.html#l00063">twiReadBuffer</a>, <a class="el" href="i2c_8c-source.html#l00069">twiState</a>, <a class="el" href="i2c_8c-source.html#l00070">twiTransactionType</a>, <a class="el" href="i2c_8c-source.html#l00062">twiWriteBuffer</a>, <a class="el" href="i2c_8c-source.html#l00064">writeInPointer</a>, and <a class="el" href="i2c_8c-source.html#l00065">writeOutPointer</a>.
</div>
</div><p>
<a class="anchor" name="71aad4195d87f8c719f6fef3f1d17e8e"></a><!-- doxytag: member="i2c.c::twiCompletionStatus" ref="71aad4195d87f8c719f6fef3f1d17e8e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t twiCompletionStatus           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check the completion status of a transaction. 
<p>
The software state variable is checked for the IDLE state, and for any stop condition to have been completed. If finished, then a code is returned indicating:<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>a status variable: Not finished 0xFF Success 0 Write interrupted 0x80 + number of bytes written Read interrupted 0x40 + number of bytes read </dd></dl>

<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00136">136</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
References <a class="el" href="i2c_8c-source.html#l00068">readCount</a>, <a class="el" href="i2c_8c-source.html#l00066">readInPointer</a>, <a class="el" href="i2c_8h-source.html#l00046">TWI_IDLE</a>, <a class="el" href="i2c_8c-source.html#l00069">twiState</a>, <a class="el" href="i2c_8c-source.html#l00064">writeInPointer</a>, and <a class="el" href="i2c_8c-source.html#l00065">writeOutPointer</a>.
</div>
</div><p>
<a class="anchor" name="439ac51801d573da902afa09abf871c1"></a><!-- doxytag: member="i2c.c::twiErrorStatus" ref="439ac51801d573da902afa09abf871c1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t twiErrorStatus           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Check the error status of a transaction. 
<p>
This function will read the current state variable and report back the transaction status in the form of an error code.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>a status variable: Not finished 0xFF Success 0 or an error code if it has aborted</dd></dl>
The software state variable is checked for the IDLE state, and for any stop condition to have been completed. If finished, then the last error code is returned. This is zero if no error occurred. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00114">114</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
References <a class="el" href="i2c_8h-source.html#l00046">TWI_IDLE</a>, <a class="el" href="i2c_8c-source.html#l00071">twiLastError</a>, and <a class="el" href="i2c_8c-source.html#l00069">twiState</a>.
</div>
</div><p>
<a class="anchor" name="fe7c859443efabc1eb3a47bdf8abdf3c"></a><!-- doxytag: member="i2c.c::twiInit" ref="fe7c859443efabc1eb3a47bdf8abdf3c" args="(uint16_t bitRate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void twiInit           </td>
          <td>(</td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>bitRate</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Initialise the TWI interface. 
<p>
This function will initialise the I2C interface with bit rate settings.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>bitRate</em>&nbsp;</td><td>The bitrate to use for the TWI in kHz (maximum 400) </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00083">83</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
References <a class="el" href="i2c_8h-source.html#l00031">F_CPU</a>, and <a class="el" href="i2c_8h-source.html#l00077">outb</a>.
</div>
</div><p>
<a class="anchor" name="cc2a1b3d7c45f9721291f024262988a4"></a><!-- doxytag: member="i2c.c::twiLaunch" ref="cc2a1b3d7c45f9721291f024262988a4" args="(uint8_t device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t twiLaunch           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>device</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Launch a master transaction with a slave device. 
<p>
The calling program is expected to have setup the transaction by putting data in the write buffer and a number of bytes to be read. If no bytes to write, the transaction is a master read. If no bytes to read the transaction is a master write. If bytes to write and read the transaction is an atomic write/read. If nothing to do, bomb out.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>device</em>&nbsp;</td><td>address identifier for the slave </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>TRUE if there was no error. An error would occur if this was called in the middle of another transaction or if there was nothing to do. </dd></dl>

<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00220">220</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
References <a class="el" href="i2c_8h-source.html#l00074">_BV</a>, <a class="el" href="i2c_8h-source.html#l00063">ATOMIC_TRANSACTION</a>, <a class="el" href="i2c_8c-source.html#l00056">FALSE</a>, <a class="el" href="i2c_8h-source.html#l00077">outb</a>, <a class="el" href="i2c_8h-source.html#l00065">READ_TRANSACTION</a>, <a class="el" href="i2c_8c-source.html#l00068">readCount</a>, <a class="el" href="i2c_8c-source.html#l00055">TRUE</a>, <a class="el" href="i2c_8h-source.html#l00068">TWI_CONTROL</a>, <a class="el" href="i2c_8h-source.html#l00046">TWI_IDLE</a>, <a class="el" href="i2c_8h-source.html#l00049">TWI_START</a>, <a class="el" href="i2c_8c-source.html#l00072">twiDevice</a>, <a class="el" href="i2c_8c-source.html#l00071">twiLastError</a>, <a class="el" href="i2c_8c-source.html#l00069">twiState</a>, <a class="el" href="i2c_8c-source.html#l00070">twiTransactionType</a>, <a class="el" href="i2c_8h-source.html#l00064">WRITE_TRANSACTION</a>, and <a class="el" href="i2c_8c-source.html#l00064">writeInPointer</a>.
</div>
</div><p>
<a class="anchor" name="0e20b6beb36cbeea87e0cad72b90829f"></a><!-- doxytag: member="i2c.c::twiReadByte" ref="0e20b6beb36cbeea87e0cad72b90829f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t twiReadByte           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Read the next received byte from the read buffer. 
<p>
The calling program is expected to determine how many bytes have been received and if there was any error occurred before calling this function. The next read byte is returned, unless attempting to read beyond the end of the buffer whence 0xFF is returned and the pointer is not incremented.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>byte from the read buffer </dd></dl>

<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00198">198</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
References <a class="el" href="i2c_8h-source.html#l00071">BUFFER_SIZE</a>, <a class="el" href="i2c_8c-source.html#l00067">readOutPointer</a>, and <a class="el" href="i2c_8c-source.html#l00063">twiReadBuffer</a>.
</div>
</div><p>
<a class="anchor" name="f4ded1cc09e6f5b30c44d48a198c08a5"></a><!-- doxytag: member="i2c.c::twiSetupTransaction" ref="f4ded1cc09e6f5b30c44d48a198c08a5" args="(uint8_t numBytes)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void twiSetupTransaction           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>numBytes</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Clear the read and write buffers and set the bytes to be read. 
<p>
All in and out pointers are reset and the read count is set to the number of bytes to be read. The input pointers are incremented as each byte is written to the buffer, and the output pointers are incremented through the buffer as they are read out. Once this is done, transmitted bytes must be first written to the write buffer before launching the transaction.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>numBytes</em>&nbsp;</td><td>number of bytes to be read </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00160">160</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
References <a class="el" href="i2c_8c-source.html#l00068">readCount</a>, <a class="el" href="i2c_8c-source.html#l00066">readInPointer</a>, <a class="el" href="i2c_8c-source.html#l00067">readOutPointer</a>, <a class="el" href="i2c_8c-source.html#l00064">writeInPointer</a>, and <a class="el" href="i2c_8c-source.html#l00065">writeOutPointer</a>.
</div>
</div><p>
<a class="anchor" name="2cb90fd0e5a775d5be957c0a7617fca2"></a><!-- doxytag: member="i2c.c::twiWriteByte" ref="2cb90fd0e5a775d5be957c0a7617fca2" args="(uint8_t dataByte)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t twiWriteByte           </td>
          <td>(</td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>dataByte</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Write the next transmitted byte to the write buffer. 
<p>
If the buffer is full, the byte is not written.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>dataByte</em>&nbsp;</td><td>to be transmitted next </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>FALSE if the buffer is full </dd></dl>

<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00179">179</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
References <a class="el" href="i2c_8h-source.html#l00071">BUFFER_SIZE</a>, <a class="el" href="i2c_8c-source.html#l00056">FALSE</a>, <a class="el" href="i2c_8c-source.html#l00055">TRUE</a>, <a class="el" href="i2c_8c-source.html#l00062">twiWriteBuffer</a>, and <a class="el" href="i2c_8c-source.html#l00064">writeInPointer</a>.
</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="76c1e63ec99027b5f7991d5f0ad099da"></a><!-- doxytag: member="i2c.c::readCount" ref="76c1e63ec99027b5f7991d5f0ad099da" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#76c1e63ec99027b5f7991d5f0ad099da">readCount</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Number of bytes to receive. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00068">68</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, <a class="el" href="i2c_8c-source.html#l00136">twiCompletionStatus()</a>, <a class="el" href="i2c_8c-source.html#l00220">twiLaunch()</a>, and <a class="el" href="i2c_8c-source.html#l00160">twiSetupTransaction()</a>.
</div>
</div><p>
<a class="anchor" name="07881f4dd76bb3248bb4a3556aa9ebcd"></a><!-- doxytag: member="i2c.c::readInPointer" ref="07881f4dd76bb3248bb4a3556aa9ebcd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#07881f4dd76bb3248bb4a3556aa9ebcd">readInPointer</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pointer for receiving to buffer. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00066">66</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, <a class="el" href="i2c_8c-source.html#l00136">twiCompletionStatus()</a>, and <a class="el" href="i2c_8c-source.html#l00160">twiSetupTransaction()</a>.
</div>
</div><p>
<a class="anchor" name="6b80d6db55239fc3eaccaa8ced9143d0"></a><!-- doxytag: member="i2c.c::readOutPointer" ref="6b80d6db55239fc3eaccaa8ced9143d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#6b80d6db55239fc3eaccaa8ced9143d0">readOutPointer</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pointer for reading from buffer. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00067">67</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00198">twiReadByte()</a>, and <a class="el" href="i2c_8c-source.html#l00160">twiSetupTransaction()</a>.
</div>
</div><p>
<a class="anchor" name="bdb98999790665ec01fb67c8cbcf7542"></a><!-- doxytag: member="i2c.c::twiDevice" ref="bdb98999790665ec01fb67c8cbcf7542" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#bdb98999790665ec01fb67c8cbcf7542">twiDevice</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Device address. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00072">72</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, and <a class="el" href="i2c_8c-source.html#l00220">twiLaunch()</a>.
</div>
</div><p>
<a class="anchor" name="9cdbe69356f0acf2eb14f6ae6ec97339"></a><!-- doxytag: member="i2c.c::twiLastError" ref="9cdbe69356f0acf2eb14f6ae6ec97339" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#9cdbe69356f0acf2eb14f6ae6ec97339">twiLastError</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Error code of latest error detected. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00071">71</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, <a class="el" href="i2c_8c-source.html#l00114">twiErrorStatus()</a>, and <a class="el" href="i2c_8c-source.html#l00220">twiLaunch()</a>.
</div>
</div><p>
<a class="anchor" name="8346cb3961702395920073c0fc633cda"></a><!-- doxytag: member="i2c.c::twiReadBuffer" ref="8346cb3961702395920073c0fc633cda" args="[BUFFER_SIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#8346cb3961702395920073c0fc633cda">twiReadBuffer</a>[BUFFER_SIZE]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Input buffer. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00063">63</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, and <a class="el" href="i2c_8c-source.html#l00198">twiReadByte()</a>.
</div>
</div><p>
<a class="anchor" name="041be4eeebb2ae2bb8e4a5de96ba208b"></a><!-- doxytag: member="i2c.c::twiState" ref="041be4eeebb2ae2bb8e4a5de96ba208b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#041be4eeebb2ae2bb8e4a5de96ba208b">twiState</a> = TWI_IDLE          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
State variable for ISR state machine. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00069">69</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, <a class="el" href="i2c_8c-source.html#l00136">twiCompletionStatus()</a>, <a class="el" href="i2c_8c-source.html#l00114">twiErrorStatus()</a>, and <a class="el" href="i2c_8c-source.html#l00220">twiLaunch()</a>.
</div>
</div><p>
<a class="anchor" name="ebe86cb4e006a71152269ec077d71559"></a><!-- doxytag: member="i2c.c::twiTransactionType" ref="ebe86cb4e006a71152269ec077d71559" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#ebe86cb4e006a71152269ec077d71559">twiTransactionType</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Type of transaction to execute. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00070">70</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, and <a class="el" href="i2c_8c-source.html#l00220">twiLaunch()</a>.
</div>
</div><p>
<a class="anchor" name="7fdb3f4462c25ceb53f923c697d904c2"></a><!-- doxytag: member="i2c.c::twiWriteBuffer" ref="7fdb3f4462c25ceb53f923c697d904c2" args="[BUFFER_SIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#7fdb3f4462c25ceb53f923c697d904c2">twiWriteBuffer</a>[BUFFER_SIZE]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Output buffer. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00062">62</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, and <a class="el" href="i2c_8c-source.html#l00179">twiWriteByte()</a>.
</div>
</div><p>
<a class="anchor" name="a3999b6dd3f5153e28720c1f7a4a8496"></a><!-- doxytag: member="i2c.c::writeInPointer" ref="a3999b6dd3f5153e28720c1f7a4a8496" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#a3999b6dd3f5153e28720c1f7a4a8496">writeInPointer</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pointer for writing to buffer. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00064">64</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, <a class="el" href="i2c_8c-source.html#l00136">twiCompletionStatus()</a>, <a class="el" href="i2c_8c-source.html#l00220">twiLaunch()</a>, <a class="el" href="i2c_8c-source.html#l00160">twiSetupTransaction()</a>, and <a class="el" href="i2c_8c-source.html#l00179">twiWriteByte()</a>.
</div>
</div><p>
<a class="anchor" name="7c5aa6646338d4b0375c16a011380f2d"></a><!-- doxytag: member="i2c.c::writeOutPointer" ref="7c5aa6646338d4b0375c16a011380f2d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t <a class="el" href="i2c_8c.html#7c5aa6646338d4b0375c16a011380f2d">writeOutPointer</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Pointer for transmitting from buffer. 
<p>
Definition at line <a class="el" href="i2c_8c-source.html#l00065">65</a> of file <a class="el" href="i2c_8c-source.html">i2c.c</a>.
<p>
Referenced by <a class="el" href="i2c_8c-source.html#l00257">ISR()</a>, <a class="el" href="i2c_8c-source.html#l00136">twiCompletionStatus()</a>, and <a class="el" href="i2c_8c-source.html#l00160">twiSetupTransaction()</a>.
</div>
</div><p>
<hr size="1"><address style="align: right;"><small>Generated on Tue Sep 4 14:07:30 2007 for AVR I2C Master Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
