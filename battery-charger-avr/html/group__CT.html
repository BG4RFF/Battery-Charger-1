<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BatteryCharger: Control Tasks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Control Tasks</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga191232e6a11e2e3ff418840dd0e96165">initiateControlTask</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Launch the Control task.  <a href="#ga191232e6a11e2e3ff418840dd0e96165"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#gaa64a0693168a30814f9304c373e0340c">measurementTask</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga3cf36f2c1a76081759b205461a58486b">controlTask</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga4fa00331e1f30a77a6c22295226a3e5f">displayTask</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Display task.  <a href="#ga4fa00331e1f30a77a6c22295226a3e5f"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#gaa98c853e40224609bfb1150530123d7f">channelValue</a> [4]</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Measurement task.  <a href="#gaa98c853e40224609bfb1150530123d7f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga6d4cd547517c8331715865748d9c2f7e">scaledChannelValue</a> [4]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga307d9943a14a6b19c4272b05c3a22d01">numberChannels</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga3f9a04c249fcdf6216c1104dda09553c">channelStart</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga4b613adf1dc9edfbc9951cf9b86ec2e3">channel</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga863aa1edc15e9c0c0f7812cac7a84b37">channelNumber</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga683ddf1e172ab3052c730d41751c9c99">channelSum</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga79e49232ccb40996ca8cfebadb69c1ab">adcErrorCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga8a85bc7d7d36db4ec2eaae40ce38014f">sampleCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga7aafd39915cb2964fccb589505391d7e">testCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint16_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#ga8942fcd352fdad998588e0ab2a20bffb">runCount</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">volatile uint8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CT.html#gafb27ac1d046463811b29e7c0420f3f29">storeCount</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Control task.  <a href="#gafb27ac1d046463811b29e7c0420f3f29"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>These functions provide the control and display functionality of the Battery Charger application. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga3cf36f2c1a76081759b205461a58486b"></a><!-- doxytag: member="batterychargermain.c::controlTask" ref="ga3cf36f2c1a76081759b205461a58486b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void controlTask </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>Start the measurement task and wait until it reschedules us.</p>
<p>Float charging - if the voltage is below the threshold, open the source to charge, otherwise short the panel until the voltage drops.</p>
<p>Store some state variable data in external EEPROM every storeInterval (&gt;0) ticks.</p>
<p>Write the new pointers to their location in EEPROM. </p>
</p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00404">404</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>References <a class="el" href="batterychargermain_8h_source.html#l00068">BUFFER_START</a>, <a class="el" href="batterychargermain_8c_source.html#l00159">bufferEndPointer</a>, <a class="el" href="batterychargermain_8c_source.html#l00158">bufferStartPointer</a>, <a class="el" href="batterychargermain_8c_source.html#l00110">controlDelayCounter</a>, <a class="el" href="batterychargermain_8c_source.html#l00172">controlDisable</a>, <a class="el" href="batterychargermain_8h_source.html#l00071">DATA_BLOCK_SIZE</a>, <a class="el" href="batterychargermain_8c_source.html#l00168">eepromEnd</a>, <a class="el" href="batterychargermain_8c_source.html#l00080">FALSE</a>, <a class="el" href="batterychargermain_8c_source.html#l00173">floatThreshold</a>, <a class="el" href="batterychargermain_8c_source.html#l00089">high</a>, <a class="el" href="batterychargermain_8c_source.html#l00167">localEEPROMDevice</a>, <a class="el" href="batterychargermain_8c_source.html#l00090">low</a>, <a class="el" href="batterychargermain_8c_source.html#l00171">measureInterval</a>, <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>, <a class="el" href="batterychargermain_8c_source.html#l00149">measurementTaskID</a>, <a class="el" href="batterychargermain_8c_source.html#l00160">newBufferEndPointer</a>, <a class="el" href="batterychargermain_8c_source.html#l01383">openPanel()</a>, <a class="el" href="batterychargermain_8c_source.html#l00303">scaledChannelValue</a>, <a class="el" href="batterychargermain_8c_source.html#l01391">shortPanel()</a>, <a class="el" href="batterychargermain_8c_source.html#l00402">storeCount</a>, <a class="el" href="batterychargermain_8c_source.html#l00170">storeInterval</a>, <a class="el" href="batterychargermain_8c.html#a85f9d04fa58cdbb8d366d1d238df2298">time</a>, and <a class="el" href="batterychargermain_8c_source.html#l00101">timeUnion::timeByte</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00248">initiateControlTask()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__CT_ga3cf36f2c1a76081759b205461a58486b_cgraph.png" border="0" usemap="#group__CT_ga3cf36f2c1a76081759b205461a58486b_cgraph_map" alt=""></div>
<map name="group__CT_ga3cf36f2c1a76081759b205461a58486b_cgraph_map" id="group__CT_ga3cf36f2c1a76081759b205461a58486b_cgraph">
<area shape="rect" href="group__CT.html#gaa64a0693168a30814f9304c373e0340c" title="measurementTask" alt="" coords="141,5,269,35"/><area shape="rect" href="group__BSHF.html#gaf3ffcbf6810151d25d3bd59d1c9368a6" title="Port B output 0 when high will open the panel for charging." alt="" coords="165,59,245,88"/><area shape="rect" href="group__BSHF.html#gadb553bc5b111241ffdb14d98f4471cbe" title="Port B output 0 when low will short the panel." alt="" coords="164,112,247,141"/><area shape="rect" href="batterychargermain_8c.html#ab54b3bf861d0d10e37596e01b486fa88" title="Scale a measured A/D quantity." alt="" coords="317,5,381,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga4fa00331e1f30a77a6c22295226a3e5f"></a><!-- doxytag: member="batterychargermain.c::displayTask" ref="ga4fa00331e1f30a77a6c22295226a3e5f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void displayTask </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Display task. </p>
<p>This task tests for user input via a hardware push button and manages the LCD display of system variables and configuration of certain items. </p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00491">491</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>References <a class="el" href="batterychargermain_8c_source.html#l01304">display()</a>, and <a class="el" href="batterychargermain_8c_source.html#l00303">scaledChannelValue</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00248">initiateControlTask()</a>, and <a class="el" href="batterychargermain_8c_source.html#l01240">ISR()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__CT_ga4fa00331e1f30a77a6c22295226a3e5f_cgraph.png" border="0" usemap="#group__CT_ga4fa00331e1f30a77a6c22295226a3e5f_cgraph_map" alt=""></div>
<map name="group__CT_ga4fa00331e1f30a77a6c22295226a3e5f_cgraph_map" id="group__CT_ga4fa00331e1f30a77a6c22295226a3e5f_cgraph">
<area shape="rect" href="group__UIT.html#ga5f63e93affef46753d63308e74e09abe" title="Display a 32 bit value as decimal on the LCD." alt="" coords="145,5,207,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga191232e6a11e2e3ff418840dd0e96165"></a><!-- doxytag: member="batterychargermain.c::initiateControlTask" ref="ga191232e6a11e2e3ff418840dd0e96165" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initiateControlTask </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Launch the Control task. </p>
<p>This task sets up the main control tasks by initializing the EEPROM storage. When ready it initiates the tasks to run regularly and check the battery voltage. This task then terminates. </p>

<p><p>Setup the external EEPROM for storing the samples. The first 16 bytes are reserved for general control information which includes the buffer pointers needed to recover data when power fails. These pointers are held in locations 8 to 11.</p>
<p>Start the control task that runs forever in a loop.</p>
<p>Start the display task runs at intervals restarted by the timer ISR. Set the timer going once per second </p>
</p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00248">248</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>References <a class="el" href="batterychargermain_8c_source.html#l00169">adcShift</a>, <a class="el" href="batterychargermain_8h_source.html#l00068">BUFFER_START</a>, <a class="el" href="batterychargermain_8c_source.html#l00159">bufferEndPointer</a>, <a class="el" href="batterychargermain_8c_source.html#l00158">bufferStartPointer</a>, <a class="el" href="batterychargermain_8c_source.html#l00110">controlDelayCounter</a>, <a class="el" href="batterychargermain_8c_source.html#l00172">controlDisable</a>, <a class="el" href="batterychargermain_8c_source.html#l00404">controlTask()</a>, <a class="el" href="batterychargermain_8c_source.html#l00148">controlTaskID</a>, <a class="el" href="batterychargermain_8c_source.html#l00113">displayInterval</a>, <a class="el" href="batterychargermain_8c_source.html#l00491">displayTask()</a>, <a class="el" href="batterychargermain_8c_source.html#l00112">displayTaskCounter</a>, <a class="el" href="batterychargermain_8c_source.html#l00150">displayTaskID</a>, <a class="el" href="batterychargermain_8c_source.html#l00080">FALSE</a>, <a class="el" href="batterychargermain_8c_source.html#l00089">high</a>, <a class="el" href="batterychargermain_8c_source.html#l00167">localEEPROMDevice</a>, <a class="el" href="batterychargermain_8c_source.html#l00090">low</a>, <a class="el" href="batterychargermain_8c_source.html#l01331">setErrorCode()</a>, <a class="el" href="batterychargermain_8c_source.html#l00170">storeInterval</a>, <a class="el" href="batterychargermain_8c_source.html#l00079">TRUE</a>, and <a class="el" href="batterychargermain_8h_source.html#l00129">WRITE_EEPROM_FAIL</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00179">main()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__CT_ga191232e6a11e2e3ff418840dd0e96165_cgraph.png" border="0" usemap="#group__CT_ga191232e6a11e2e3ff418840dd0e96165_cgraph_map" alt=""></div>
<map name="group__CT_ga191232e6a11e2e3ff418840dd0e96165_cgraph_map" id="group__CT_ga191232e6a11e2e3ff418840dd0e96165_cgraph">
<area shape="rect" href="group__CT.html#ga3cf36f2c1a76081759b205461a58486b" title="controlTask" alt="" coords="187,85,275,115"/><area shape="rect" href="group__CT.html#ga4fa00331e1f30a77a6c22295226a3e5f" title="Display task." alt="" coords="185,165,276,195"/><area shape="rect" href="group__UIT.html#ga3a0f1749987e2d979e5216e045fe5fb2" title="Set the Error Code." alt="" coords="183,219,279,248"/><area shape="rect" href="group__CT.html#gaa64a0693168a30814f9304c373e0340c" title="measurementTask" alt="" coords="328,5,456,35"/><area shape="rect" href="group__BSHF.html#gaf3ffcbf6810151d25d3bd59d1c9368a6" title="Port B output 0 when high will open the panel for charging." alt="" coords="352,59,432,88"/><area shape="rect" href="group__BSHF.html#gadb553bc5b111241ffdb14d98f4471cbe" title="Port B output 0 when low will short the panel." alt="" coords="351,112,433,141"/><area shape="rect" href="batterychargermain_8c.html#ab54b3bf861d0d10e37596e01b486fa88" title="Scale a measured A/D quantity." alt="" coords="504,5,568,35"/><area shape="rect" href="group__UIT.html#ga5f63e93affef46753d63308e74e09abe" title="Display a 32 bit value as decimal on the LCD." alt="" coords="361,165,423,195"/><area shape="rect" href="group__BSHF.html#ga05d5c098157944c524536014c04450bc" title="Port B output 2 when high will turn on a LED." alt="" coords="361,219,423,248"/><area shape="rect" href="group__BSHF.html#ga86980aa118e8cc1e123632b17ce5cdcd" title="Port B output 2 when low will turn off a LED." alt="" coords="363,272,421,301"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaa64a0693168a30814f9304c373e0340c"></a><!-- doxytag: member="batterychargermain.c::measurementTask" ref="gaa64a0693168a30814f9304c373e0340c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void measurementTask </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>Check that all analogue channels are defined and get the necessary scale factors. This needs to happen regularly in case the EEPROM data is changed, so we do this every time.</p>
<p>The channel Identifier (second channel IB location) has the channel type in the upper four bits, and the channel number in the lower.</p>
<p>If the channel type is a configure channel, update the configuration variables</p>
<p>Check that the channel type is Simple A/D</p>
<p>Compute the number of averaging iterations. Note that the channel sums are maintained as 32 bit values so we can average quite aggressively (but more averaging takes up more time).</p>
<p>In the event of an error, we do not add in the measured value, but we must be able to account for the missing elements. We do this by keeping a count of errored values, and when we get a good value, fill in the previous missing values with multiple copies of it. A better way would be to use the average value as a substitute, but this complicates the arithmetic significantly. Such errors are never signalled back.</p>
<p>The summed results need to be scaled back to 10 bits to match the A/D precision.</p>
<p>The scaled result according to calibration is also stored for display. </p>
</p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00314">314</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>References <a class="el" href="batterychargermain_8c_source.html#l00082">_BV</a>, <a class="el" href="batterychargermain_8c_source.html#l00309">adcErrorCount</a>, <a class="el" href="batterychargermain_8c_source.html#l00169">adcShift</a>, <a class="el" href="batterychargermain_8c_source.html#l00306">channel</a>, <a class="el" href="batterychargermain_8c_source.html#l00307">channelNumber</a>, <a class="el" href="batterychargermain_8c_source.html#l00305">channelStart</a>, <a class="el" href="batterychargermain_8c_source.html#l00308">channelSum</a>, <a class="el" href="batterychargermain_8c_source.html#l00302">channelValue</a>, <a class="el" href="batterychargermain_8c_source.html#l00172">controlDisable</a>, <a class="el" href="batterychargermain_8c_source.html#l00148">controlTaskID</a>, <a class="el" href="batterychargermain_8c_source.html#l00080">FALSE</a>, <a class="el" href="batterychargermain_8c_source.html#l00173">floatThreshold</a>, <a class="el" href="batterychargermain_8c_source.html#l00171">measureInterval</a>, <a class="el" href="batterychargermain_8c_source.html#l00304">numberChannels</a>, <a class="el" href="batterychargermain_8c_source.html#l01269">rescale()</a>, <a class="el" href="batterychargermain_8c_source.html#l00310">sampleCount</a>, <a class="el" href="batterychargermain_8c_source.html#l00303">scaledChannelValue</a>, and <a class="el" href="batterychargermain_8c_source.html#l00170">storeInterval</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00404">controlTask()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__CT_gaa64a0693168a30814f9304c373e0340c_cgraph.png" border="0" usemap="#group__CT_gaa64a0693168a30814f9304c373e0340c_cgraph_map" alt=""></div>
<map name="group__CT_gaa64a0693168a30814f9304c373e0340c_cgraph_map" id="group__CT_gaa64a0693168a30814f9304c373e0340c_cgraph">
<area shape="rect" href="batterychargermain_8c.html#ab54b3bf861d0d10e37596e01b486fa88" title="Scale a measured A/D quantity." alt="" coords="181,5,245,35"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ga79e49232ccb40996ca8cfebadb69c1ab"></a><!-- doxytag: member="batterychargermain.c::adcErrorCount" ref="ga79e49232ccb40996ca8cfebadb69c1ab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint16_t <a class="el" href="group__CT.html#ga79e49232ccb40996ca8cfebadb69c1ab">adcErrorCount</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00309">309</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>.</p>

</div>
</div>
<a class="anchor" id="ga4b613adf1dc9edfbc9951cf9b86ec2e3"></a><!-- doxytag: member="batterychargermain.c::channel" ref="ga4b613adf1dc9edfbc9951cf9b86ec2e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t <a class="el" href="group__CT.html#ga4b613adf1dc9edfbc9951cf9b86ec2e3">channel</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00306">306</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>, and <a class="el" href="batterychargermain_8c_source.html#l00553">processCommand()</a>.</p>

</div>
</div>
<a class="anchor" id="ga863aa1edc15e9c0c0f7812cac7a84b37"></a><!-- doxytag: member="batterychargermain.c::channelNumber" ref="ga863aa1edc15e9c0c0f7812cac7a84b37" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t <a class="el" href="group__CT.html#ga863aa1edc15e9c0c0f7812cac7a84b37">channelNumber</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00307">307</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>.</p>

</div>
</div>
<a class="anchor" id="ga3f9a04c249fcdf6216c1104dda09553c"></a><!-- doxytag: member="batterychargermain.c::channelStart" ref="ga3f9a04c249fcdf6216c1104dda09553c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t <a class="el" href="group__CT.html#ga3f9a04c249fcdf6216c1104dda09553c">channelStart</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00305">305</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>.</p>

</div>
</div>
<a class="anchor" id="ga683ddf1e172ab3052c730d41751c9c99"></a><!-- doxytag: member="batterychargermain.c::channelSum" ref="ga683ddf1e172ab3052c730d41751c9c99" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint32_t <a class="el" href="group__CT.html#ga683ddf1e172ab3052c730d41751c9c99">channelSum</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00308">308</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>.</p>

</div>
</div>
<a class="anchor" id="gaa98c853e40224609bfb1150530123d7f"></a><!-- doxytag: member="batterychargermain.c::channelValue" ref="gaa98c853e40224609bfb1150530123d7f" args="[4]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint16_t <a class="el" href="group__CT.html#gaa98c853e40224609bfb1150530123d7f">channelValue</a>[4]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Measurement task. </p>
<p>This task measures the voltages and currents from the A/D converters, and scales them according to the calibrated values in the internal EEPROM block. The results are stored in two global arrays: one for the unscaled and one for the scaled values respectively. The order of entries follows the channel number order which must be set correctly by the configuration program to match the A/D converter input numbers.</p>
<p>Since we are checking the channel blocks for the Simple A/D converter information blocks, we also update any other configuration parameters if we come across a general configuration block. All other information blocks are ignored. </p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00302">302</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>, and <a class="el" href="batterychargermain_8c_source.html#l00553">processCommand()</a>.</p>

</div>
</div>
<a class="anchor" id="ga307d9943a14a6b19c4272b05c3a22d01"></a><!-- doxytag: member="batterychargermain.c::numberChannels" ref="ga307d9943a14a6b19c4272b05c3a22d01" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t <a class="el" href="group__CT.html#ga307d9943a14a6b19c4272b05c3a22d01">numberChannels</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00304">304</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>.</p>

</div>
</div>
<a class="anchor" id="ga8942fcd352fdad998588e0ab2a20bffb"></a><!-- doxytag: member="batterychargermain.c::runCount" ref="ga8942fcd352fdad998588e0ab2a20bffb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint16_t <a class="el" href="group__CT.html#ga8942fcd352fdad998588e0ab2a20bffb">runCount</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00312">312</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga8a85bc7d7d36db4ec2eaae40ce38014f"></a><!-- doxytag: member="batterychargermain.c::sampleCount" ref="ga8a85bc7d7d36db4ec2eaae40ce38014f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint16_t <a class="el" href="group__CT.html#ga8a85bc7d7d36db4ec2eaae40ce38014f">sampleCount</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00310">310</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>.</p>

</div>
</div>
<a class="anchor" id="ga6d4cd547517c8331715865748d9c2f7e"></a><!-- doxytag: member="batterychargermain.c::scaledChannelValue" ref="ga6d4cd547517c8331715865748d9c2f7e" args="[4]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint16_t <a class="el" href="group__CT.html#ga6d4cd547517c8331715865748d9c2f7e">scaledChannelValue</a>[4]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00303">303</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00404">controlTask()</a>, <a class="el" href="batterychargermain_8c_source.html#l00491">displayTask()</a>, and <a class="el" href="batterychargermain_8c_source.html#l00314">measurementTask()</a>.</p>

</div>
</div>
<a class="anchor" id="gafb27ac1d046463811b29e7c0420f3f29"></a><!-- doxytag: member="batterychargermain.c::storeCount" ref="gafb27ac1d046463811b29e7c0420f3f29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint8_t <a class="el" href="group__CT.html#gafb27ac1d046463811b29e7c0420f3f29">storeCount</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Control task. </p>
<p>This task runs the main control of the Battery Charger and relinquishes when possible to allow serial input and output to occur. Sample data is stored to EEPROM at intervals. This task has absolute priority.</p>
<p>The task runs forever but at the end of the code it enters a timed wait state to allow other tasks to run, otherwise the serial communications and user interface can be disrupted. </p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00402">402</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00404">controlTask()</a>.</p>

</div>
</div>
<a class="anchor" id="ga7aafd39915cb2964fccb589505391d7e"></a><!-- doxytag: member="batterychargermain.c::testCount" ref="ga7aafd39915cb2964fccb589505391d7e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile uint16_t <a class="el" href="group__CT.html#ga7aafd39915cb2964fccb589505391d7e">testCount</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00311">311</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Mar 31 23:55:16 2010 for BatteryCharger by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
