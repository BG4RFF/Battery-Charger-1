<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BatteryCharger: Serial Communication and Interpretation Tasks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Serial Communication and Interpretation Tasks</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SCIT.html#ga28016e2edd199b39d8f2d9e91e2f0b9b">processError</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Error Processing task.  <a href="#ga28016e2edd199b39d8f2d9e91e2f0b9b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SCIT.html#ga205d394554b7ed3eba57e98560bd63d6">processCommand</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Input Packet Interpretation Processing task.  <a href="#ga205d394554b7ed3eba57e98560bd63d6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SCIT.html#gacc44d8087c0b66e42e09a8d11c8d612e">inputPacketReceive</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PC Communication Input task.  <a href="#gacc44d8087c0b66e42e09a8d11c8d612e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__SCIT.html#ga76390f69852e64ce7f47a441f0b04b49">outputPacketSend</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PC Communication Output task.  <a href="#ga76390f69852e64ce7f47a441f0b04b49"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>These functions provide the serial communication interface including packet level interpretation and buffering, and command processing and execution.</p>
<p>These functions are common to this and the Acquisition and Solar Regulator projects. Some command actions may be different. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gacc44d8087c0b66e42e09a8d11c8d612e"></a><!-- doxytag: member="batterychargermain.c::inputPacketReceive" ref="gacc44d8087c0b66e42e09a8d11c8d612e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void inputPacketReceive </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PC Communication Input task. </p>
<p>This task waits for an incoming character on the UART, and packages it up into a message.</p>
<p>Low level input interface errors are ignored and such characters are lost. The input state machine works through the packet stages as characters arrive. Parameters are read in and the syntax of the packet is checked. The packet data is stored in a buffer for later interpretation. Input is blocked when the packet has been fully read in. The buffer holds one single packet in full. This allows us to discard the packet when an error occurs. A circular buffer would make such error recovery very difficult.</p>
<p>If an error occurs, the packetInState must be returned to IDLE but the input task must not be blocked.</p>
<p>The task never exits, but acts as a monitoring task that activates other tasks as appropriate. This task is not entered if the error or command processing tasks are active. If there are no incoming characters waiting, the task relinquishes. </p>

<p><ul>
<li>The idle state occurs on startup, after a command has been received fully, or when an error has occurred. When an IDLE character is received, it is echoed back if the current output is not processing anything. The sync state is terminated. The next state, SYNC, is entered. In any other case, usually flushing after an error, the character is ignored.</li>
</ul>
<ul>
<li>If a SYNC character is received, go to the COMMAND state. We can accept IDLE characters and ignore them, otherwise return to the IDLE state and flush all following characters (no error is generated)</li>
</ul>
<ul>
<li>The address+packet type tells us if the packet is addressed to us. Just accept any address for the moment until we get a means to find out who we are. The packet type is also ignored until we define more types.</li>
</ul>
<ul>
<li>If the byte count is zero (no parameters), terminate the packet, otherwise go on to the data phase.</li>
</ul>
<ul>
<li>Put the command aside and go to the data phase if more characters follow</li>
</ul>
<ul>
<li>In the DATA phase just dump everything to the buffer if it will fit. dataInByteCount points to the next location to add a byte.</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>We ignore the checksum for the moment </dd></dl>
<ul>
<li>EOM terminates the packet, and we should have an EOM character here. We can now start up the packet interpretation task, blocking any further input processing. If an error has occurred,the error task will unblock this. </li>
</ul>
</p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l01066">1066</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>References <a class="el" href="batterychargermain_8h_source.html#l00082">ADDRESS</a>, <a class="el" href="batterychargermain_8h_source.html#l00086">CHECKSUM</a>, <a class="el" href="batterychargermain_8h_source.html#l00084">COMMAND</a>, <a class="el" href="batterychargermain_8h_source.html#l00121">COMMAND_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00044">DATA_BUFFER_SIZE</a>, <a class="el" href="batterychargermain_8h_source.html#l00085">DATA_PHASE</a>, <a class="el" href="batterychargermain_8c_source.html#l00128">dataInByteCount</a>, <a class="el" href="batterychargermain_8h_source.html#l00087">EOM</a>, <a class="el" href="batterychargermain_8h_source.html#l00092">EOM_CHAR</a>, <a class="el" href="batterychargermain_8c_source.html#l00080">FALSE</a>, <a class="el" href="batterychargermain_8c_source.html#l00089">high</a>, <a class="el" href="batterychargermain_8h_source.html#l00080">IDLE</a>, <a class="el" href="batterychargermain_8h_source.html#l00090">IDLE_CHAR</a>, <a class="el" href="batterychargermain_8c_source.html#l00130">inputBuffer</a>, <a class="el" href="batterychargermain_8c_source.html#l00129">inputCommand</a>, <a class="el" href="batterychargermain_8c_source.html#l00121">lastError</a>, <a class="el" href="batterychargermain_8h_source.html#l00083">NUMBER_BYTES</a>, <a class="el" href="batterychargermain_8c_source.html#l00127">numberInBytes</a>, <a class="el" href="batterychargermain_8c_source.html#l00136">numberOutBytes</a>, <a class="el" href="batterychargermain_8c_source.html#l00139">outputBuffer</a>, <a class="el" href="batterychargermain_8c_source.html#l00134">outputBusy</a>, <a class="el" href="batterychargermain_8c_source.html#l00126">packetInState</a>, <a class="el" href="batterychargermain_8c_source.html#l00553">processCommand()</a>, <a class="el" href="batterychargermain_8c_source.html#l00145">processCommandID</a>, <a class="el" href="batterychargermain_8c_source.html#l00529">processError()</a>, <a class="el" href="batterychargermain_8c_source.html#l00146">processErrorID</a>, <a class="el" href="batterychargermain_8h_source.html#l00081">SYNC</a>, <a class="el" href="batterychargermain_8h_source.html#l00091">SYNC_CHAR</a>, and <a class="el" href="batterychargermain_8c_source.html#l00120">uartInput</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00179">main()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__SCIT_gacc44d8087c0b66e42e09a8d11c8d612e_cgraph.png" border="0" usemap="#group__SCIT_gacc44d8087c0b66e42e09a8d11c8d612e_cgraph_map" alt=""></div>
<map name="group__SCIT_gacc44d8087c0b66e42e09a8d11c8d612e_cgraph_map" id="group__SCIT_gacc44d8087c0b66e42e09a8d11c8d612e_cgraph">
<area shape="rect" href="group__SCIT.html#ga205d394554b7ed3eba57e98560bd63d6" title="Input Packet Interpretation Processing task." alt="" coords="191,5,316,35"/><area shape="rect" href="group__SCIT.html#ga28016e2edd199b39d8f2d9e91e2f0b9b" title="Error Processing task." alt="" coords="365,57,461,87"/><area shape="rect" href="group__SCIT.html#ga76390f69852e64ce7f47a441f0b04b49" title="PC Communication Output task." alt="" coords="509,32,637,61"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga76390f69852e64ce7f47a441f0b04b49"></a><!-- doxytag: member="batterychargermain.c::outputPacketSend" ref="ga76390f69852e64ce7f47a441f0b04b49" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void outputPacketSend </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PC Communication Output task. </p>
<p>This task transmits any characters found to be in the output buffer. Normally it is not activated until an entire message is ready to go.</p>
<p>Check for an active output command. If none, but an error is signalled, send error message. Each command requires a response so a packet is generated. Use a state machine to work through the stages when output buffer is free.</p>
<p>The task exits after the message has been sent. </p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l01165">1165</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>References <a class="el" href="batterychargermain_8h_source.html#l00082">ADDRESS</a>, <a class="el" href="batterychargermain_8h_source.html#l00086">CHECKSUM</a>, <a class="el" href="batterychargermain_8c_source.html#l00122">checkSum</a>, <a class="el" href="batterychargermain_8h_source.html#l00084">COMMAND</a>, <a class="el" href="batterychargermain_8h_source.html#l00085">DATA_PHASE</a>, <a class="el" href="batterychargermain_8c_source.html#l00137">dataOutByteCount</a>, <a class="el" href="batterychargermain_8h_source.html#l00087">EOM</a>, <a class="el" href="batterychargermain_8h_source.html#l00092">EOM_CHAR</a>, <a class="el" href="batterychargermain_8c_source.html#l00080">FALSE</a>, <a class="el" href="batterychargermain_8h_source.html#l00080">IDLE</a>, <a class="el" href="batterychargermain_8h_source.html#l00090">IDLE_CHAR</a>, <a class="el" href="batterychargermain_8h_source.html#l00095">NO_COMMAND</a>, <a class="el" href="batterychargermain_8h_source.html#l00083">NUMBER_BYTES</a>, <a class="el" href="batterychargermain_8c_source.html#l00136">numberOutBytes</a>, <a class="el" href="batterychargermain_8c_source.html#l00139">outputBuffer</a>, <a class="el" href="batterychargermain_8c_source.html#l00134">outputBusy</a>, <a class="el" href="batterychargermain_8c_source.html#l00138">outputCommand</a>, <a class="el" href="batterychargermain_8c_source.html#l00135">packetOutState</a>, <a class="el" href="batterychargermain_8h_source.html#l00081">SYNC</a>, <a class="el" href="batterychargermain_8h_source.html#l00091">SYNC_CHAR</a>, and <a class="el" href="batterychargermain_8c_source.html#l00079">TRUE</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l00553">processCommand()</a>, and <a class="el" href="batterychargermain_8c_source.html#l00529">processError()</a>.</p>

</div>
</div>
<a class="anchor" id="ga205d394554b7ed3eba57e98560bd63d6"></a><!-- doxytag: member="batterychargermain.c::processCommand" ref="ga205d394554b7ed3eba57e98560bd63d6" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processCommand </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Input Packet Interpretation Processing task. </p>
<p>This is where the command interpretation is done, causing a number of tasks to be initiated. The task is scheduled when the input data buffer has something in it. The input buffer has the parameters and the data following. Use a state machine approach as it gives simpler code.</p>
<p>Wait until all pending Input and Output processes are complete.</p>
<p>For each command, the number of expected parameters is checked in some way. </p>

<p><ul>
<li><em>Unit Information Block Access data.</em> No parameters. This command returns the address of the start of the information block, its length and the size of the largest block that can be transferred. Following this is the unit ID read from the on-board switches.</li>
</ul>
<ul>
<li><em> Read Internal EEPROM Memory.</em> Parameters: two byte address to access data, and number of data bytes to be read, accounting for limits. This command returns the contents of a block of internal EEPROM memory.</li>
</ul>
<ul>
<li><em> Write Internal EEPROM Memory.</em> Parameters: two byte address to access data, followed by all data bytes to be written. Expect at least 1 and no more than DATA_BUFFER_SIZE-3 data bytes to follow. This command writes the contents of a block of internal EEPROM memory.</li>
</ul>
<ul>
<li><em> Read External EEPROM.</em> Parameters: two byte address to access data followed by device address of external EEPROM, and the number of data bytes to be read, accounting for limits. This command returns the contents of a block of external EEPROM memory. The variable eepromCount contains the number of bytes to be read from the EEPROM. The twiSetupTransaction, twiWriteByte functions are nonblocking.</li>
</ul>
<ul>
<li><em> Write External EEPROM command.</em> Parameters: address to access data, followed by device ID and number of bytes and all data bytes to be written. This command writes the contents of a block of external EEPROM memory. Expect at least 1 and no more than DATA_BUFFER_SIZE-4 data bytes to follow.</li>
</ul>
<ul>
<li><em> Initiate a single A/D conversion.</em> One single A/D conversion is done. Parameters: channel number, Gain (not used). Result: Timer 4 bytes, A/D result 2 bytes.</li>
</ul>
<ul>
<li><em> Return Data Block of Current State.</em></li>
</ul>
<p>Parameters: none. Result: Length in bytes of data block A block of internal state variables selected according to application. In this case, four averaged A/D measurements, 2 bytes each, unscaled.</p>
<ul>
<li><em> Reset the circular buffer pointers.</em></li>
</ul>
<p>This command returns the buffer start and end pointers, then sets the start pointer to the end pointer. This effectively sets the buffer to empty. The calling program is then expected to immediately read in all data between the old start and end pointers to ensure that nothing is overwritten. Parameters: none. Result: none.</p>
<ul>
<li><em> Reset the Real Time Clock.</em> No parameters.</li>
</ul>
<ul>
<li><em> Jump to the bootloader.</em> This command causes the program to transfer control to the bootloader. Its purpose is to enable firmware uploads at any time. For the AVR MCU this is done by setting the MCU watchdog timer for the shortest period, and continuing its business. A watchdog timer reset will occur pushing it into the bootloader where the wdt will be disabled. This is unsatisfactory but necessary as the compiler could not handle a long jump.</li>
</ul>
<ul>
<li><em> Command not recognized.</em> Returns an error code.</li>
</ul>
<p>If an error occurred, launch the error processing task, else launch the output transmission task. Follow by rescheduling the suspended receive task. </p>
</p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00553">553</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>References <a class="el" href="batterychargermain_8h_source.html#l00131">ADC_FAILURE</a>, <a class="el" href="batterychargermain_8h_source.html#l00107">ADC_ONCE</a>, <a class="el" href="batterychargermain_8h_source.html#l00130">ADC_SYNTAX</a>, <a class="el" href="batterychargermain_8c_source.html#l00157">adcChannel</a>, <a class="el" href="batterychargermain_8c_source.html#l00155">address</a>, <a class="el" href="batterychargermain_8h_source.html#l00136">BOOT_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00112">BOOTLOADER_JUMP</a>, <a class="el" href="batterychargermain_8c_source.html#l00159">bufferEndPointer</a>, <a class="el" href="batterychargermain_8c_source.html#l00158">bufferStartPointer</a>, <a class="el" href="batterychargermain_8c_source.html#l00087">cbi</a>, <a class="el" href="batterychargermain_8c_source.html#l00306">channel</a>, <a class="el" href="batterychargermain_8c_source.html#l00302">channelValue</a>, <a class="el" href="batterychargermain_8h_source.html#l00116">CLEAR_PORT_BIT</a>, <a class="el" href="batterychargermain_8h_source.html#l00044">DATA_BUFFER_SIZE</a>, <a class="el" href="batterychargermain_8c_source.html#l00154">eepromCount</a>, <a class="el" href="batterychargermain_8h_source.html#l00038">F_CPU</a>, <a class="el" href="batterychargermain_8c_source.html#l00080">FALSE</a>, <a class="el" href="batterychargermain_8c_source.html#l00089">high</a>, <a class="el" href="batterychargermain_8c_source.html#l00083">inb</a>, <a class="el" href="batterychargermain_8h_source.html#l00065">INF_BLOCK_START</a>, <a class="el" href="batterychargermain_8c_source.html#l00130">inputBuffer</a>, <a class="el" href="batterychargermain_8c_source.html#l00129">inputCommand</a>, <a class="el" href="batterychargermain_8c_source.html#l00143">inputPacketReceiveID</a>, <a class="el" href="batterychargermain_8c_source.html#l00121">lastError</a>, <a class="el" href="batterychargermain_8c_source.html#l00090">low</a>, <a class="el" href="batterychargermain_8h_source.html#l00120">NO_ERROR</a>, <a class="el" href="batterychargermain_8h_source.html#l00144">NO_PORT</a>, <a class="el" href="batterychargermain_8c_source.html#l00127">numberInBytes</a>, <a class="el" href="batterychargermain_8c_source.html#l00136">numberOutBytes</a>, <a class="el" href="batterychargermain_8c_source.html#l00139">outputBuffer</a>, <a class="el" href="batterychargermain_8c_source.html#l00134">outputBusy</a>, <a class="el" href="batterychargermain_8c_source.html#l00138">outputCommand</a>, <a class="el" href="batterychargermain_8c_source.html#l01165">outputPacketSend()</a>, <a class="el" href="batterychargermain_8c_source.html#l00144">outputPacketSendID</a>, <a class="el" href="batterychargermain_8c_source.html#l00529">processError()</a>, <a class="el" href="batterychargermain_8h_source.html#l00100">READ_EEPROM</a>, <a class="el" href="batterychargermain_8h_source.html#l00128">READ_EEPROM_FAIL</a>, <a class="el" href="batterychargermain_8h_source.html#l00126">READ_EEPROM_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00098">READ_MEMORY</a>, <a class="el" href="batterychargermain_8h_source.html#l00124">READ_MEMORY_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00117">READ_PORT</a>, <a class="el" href="batterychargermain_8h_source.html#l00143">READ_PORT_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00113">READ_SRAM</a>, <a class="el" href="batterychargermain_8h_source.html#l00140">READ_SRAM_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00102">RESET_BUFFER_POINTERS</a>, <a class="el" href="batterychargermain_8h_source.html#l00132">RESET_BUFFER_POINTERS_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00103">RESET_CLOCK</a>, <a class="el" href="batterychargermain_8h_source.html#l00133">RESET_CLOCK_SYNTAX</a>, <a class="el" href="batterychargermain_8c_source.html#l00166">rtcScale</a>, <a class="el" href="batterychargermain_8c_source.html#l00088">sbi</a>, <a class="el" href="batterychargermain_8h_source.html#l00115">SET_PORT_BIT</a>, <a class="el" href="batterychargermain_8h_source.html#l00139">STATE_VARIABLE_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00111">STATE_VARIABLES</a>, <a class="el" href="batterychargermain_8h_source.html#l00105">SUCCESS_COMMAND</a>, <a class="el" href="batterychargermain_8c.html#a85f9d04fa58cdbb8d366d1d238df2298">time</a>, <a class="el" href="batterychargermain_8c_source.html#l00101">timeUnion::timeByte</a>, <a class="el" href="batterychargermain_8c_source.html#l00100">timeUnion::timeValue</a>, <a class="el" href="batterychargermain_8h_source.html#l00097">UNIT_INF_ACCESS</a>, <a class="el" href="batterychargermain_8h_source.html#l00134">UNIT_INF_ACCESS_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00122">UNKNOWN_COMMAND</a>, <a class="el" href="batterychargermain_8h_source.html#l00101">WRITE_EEPROM</a>, <a class="el" href="batterychargermain_8h_source.html#l00129">WRITE_EEPROM_FAIL</a>, <a class="el" href="batterychargermain_8h_source.html#l00127">WRITE_EEPROM_SYNTAX</a>, <a class="el" href="batterychargermain_8h_source.html#l00099">WRITE_MEMORY</a>, and <a class="el" href="batterychargermain_8h_source.html#l00125">WRITE_MEMORY_SYNTAX</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l01066">inputPacketReceive()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__SCIT_ga205d394554b7ed3eba57e98560bd63d6_cgraph.png" border="0" usemap="#group__SCIT_ga205d394554b7ed3eba57e98560bd63d6_cgraph_map" alt=""></div>
<map name="group__SCIT_ga205d394554b7ed3eba57e98560bd63d6_cgraph_map" id="group__SCIT_ga205d394554b7ed3eba57e98560bd63d6_cgraph">
<area shape="rect" href="group__SCIT.html#ga76390f69852e64ce7f47a441f0b04b49" title="PC Communication Output task." alt="" coords="325,5,453,35"/><area shape="rect" href="group__SCIT.html#ga28016e2edd199b39d8f2d9e91e2f0b9b" title="Error Processing task." alt="" coords="181,31,277,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga28016e2edd199b39d8f2d9e91e2f0b9b"></a><!-- doxytag: member="batterychargermain.c::processError" ref="ga28016e2edd199b39d8f2d9e91e2f0b9b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processError </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Error Processing task. </p>
<p>If an error has occurred, reset the input buffer and build an error message to be output. Wait for any output processing to finish. Input processing continues but not packet interpretation.</p>
<p>The program can place any number of explanatory bytes in the output buffer from location 1 onwards, setting numberBytes to the number of additional bytes. This is incremented again to cover the additional error code at location 0.</p>
<p>The task completes processing of the command and exits. It is activated by the input task when a message has been received. </p>

<p>Definition at line <a class="el" href="batterychargermain_8c_source.html#l00529">529</a> of file <a class="el" href="batterychargermain_8c_source.html">batterychargermain.c</a>.</p>

<p>References <a class="el" href="batterychargermain_8h_source.html#l00104">ERROR_COMMAND</a>, <a class="el" href="batterychargermain_8c_source.html#l00080">FALSE</a>, <a class="el" href="batterychargermain_8c_source.html#l00143">inputPacketReceiveID</a>, <a class="el" href="batterychargermain_8c_source.html#l00121">lastError</a>, <a class="el" href="batterychargermain_8h_source.html#l00120">NO_ERROR</a>, <a class="el" href="batterychargermain_8c_source.html#l00136">numberOutBytes</a>, <a class="el" href="batterychargermain_8c_source.html#l00139">outputBuffer</a>, <a class="el" href="batterychargermain_8c_source.html#l00134">outputBusy</a>, <a class="el" href="batterychargermain_8c_source.html#l00138">outputCommand</a>, <a class="el" href="batterychargermain_8c_source.html#l01165">outputPacketSend()</a>, and <a class="el" href="batterychargermain_8c_source.html#l00144">outputPacketSendID</a>.</p>

<p>Referenced by <a class="el" href="batterychargermain_8c_source.html#l01066">inputPacketReceive()</a>, and <a class="el" href="batterychargermain_8c_source.html#l00553">processCommand()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="group__SCIT_ga28016e2edd199b39d8f2d9e91e2f0b9b_cgraph.png" border="0" usemap="#group__SCIT_ga28016e2edd199b39d8f2d9e91e2f0b9b_cgraph_map" alt=""></div>
<map name="group__SCIT_ga28016e2edd199b39d8f2d9e91e2f0b9b_cgraph_map" id="group__SCIT_ga28016e2edd199b39d8f2d9e91e2f0b9b_cgraph">
<area shape="rect" href="group__SCIT.html#ga76390f69852e64ce7f47a441f0b04b49" title="PC Communication Output task." alt="" coords="149,5,277,35"/></map>
</div>
</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed Mar 31 23:55:16 2010 for BatteryCharger by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
